<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login / Signup - LogCash Shop</title>
  <style>
    /* Global Resets */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      min-height: 100vh;
      user-select: none;
    }
    #auth-box {
      background: rgba(255 255 255 / 0.15);
      padding: 40px 30px 30px 30px;
      border-radius: 12px;
      width: 100%;
      max-width: 420px;
      backdrop-filter: blur(6px);
      box-shadow: 0 8px 32px rgb(118 75 162 / 0.4);
      display: flex;
      flex-direction: column;
      user-select: text;
    }
    h2 {
      margin-bottom: 25px;
      text-align: center;
      font-weight: 600;
    }
    input {
      background: rgba(255 255 255 / 0.70);
      border: none;
      border-radius: 8px;
      padding: 12px 14px;
      margin-bottom: 18px;
      font-size: 16px;
      color: #333;
      transition: background 0.3s;
      width: 100%;
      box-sizing: border-box;
      user-select: text;
    }
    input::placeholder {
      color: #666;
    }
    input:focus {
      background: rgba(255 255 255 / 0.9);
      outline: none;
    }
    button.primary-btn {
      background: #ff6699;
      border: none;
      padding: 14px 0;
      border-radius: 10px;
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
      color: white;
      transition: background 0.3s ease;
      margin-bottom: 15px;
      width: 100%;
      user-select: none;
    }
    button.primary-btn:hover {
      background: #e05184;
    }
    .error-msg {
      color: #ff4d6d;
      margin-bottom: 12px;
      font-weight: 600;
      text-align: center;
      min-height: 24px;
      user-select: none;
    }
    .toggle-auth {
      text-align: center;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
    }
    .toggle-auth:hover {
      text-decoration: underline;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      margin: 0 auto 18px auto;
      animation: spin 1s linear infinite;
      display: none;
      user-select: none;
    }
    .spinner.active {
      display: block;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="auth-box" role="form" aria-describedby="auth-error">
    <h2 id="auth-title">Login</h2>
    <div id="auth-error" class="error-msg" role="alert" aria-live="assertive"></div>
    <input type="email" id="auth-email" placeholder="Email" aria-label="Email" required autocomplete="username" />
    <input type="password" id="auth-password" placeholder="Password" aria-label="Password" required autocomplete="current-password" />
    <input type="text" id="auth-name" placeholder="Full Name (Signup only)" aria-label="Full Name" style="display:none;" autocomplete="name" />
    <button id="auth-submit" class="primary-btn" aria-label="Submit Login or Signup">Login</button>
    <div class="toggle-auth" id="auth-toggle-link" tabindex="0" role="button" aria-pressed="false">Don't have an account? Sign up</div>
    <div class="spinner" id="auth-spinner" aria-hidden="true"></div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBjA2O3QDuKsAGLzq008VEDug69WDroulI",
      authDomain: "supercoollogin999.firebaseapp.com",
      databaseURL: "https://supercoollogin999-default-rtdb.firebaseio.com",
      projectId: "supercoollogin999",
      storageBucket: "supercoollogin999.firebasestorage.app",
      messagingSenderId: "472488806884",
      appId: "1:472488806884:web:d904be3b09548dbbc51ff1",
      measurementId: "G-03NQP912BX"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const authTitle = document.getElementById('auth-title');
    const authEmail = document.getElementById('auth-email');
    const authPassword = document.getElementById('auth-password');
    const authName = document.getElementById('auth-name');
    const authSubmit = document.getElementById('auth-submit');
    const authToggleLink = document.getElementById('auth-toggle-link');
    const authError = document.getElementById('auth-error');
    const authSpinner = document.getElementById('auth-spinner');

    let isLoginMode = true; // Track mode

    function toggleAuthMode() {
      isLoginMode = !isLoginMode;
      authError.textContent = "";
      if (isLoginMode) {
        authTitle.textContent = "Login";
        authSubmit.textContent = "Login";
        authToggleLink.textContent = "Don't have an account? Sign up";
        authName.style.display = "none";
      } else {
        authTitle.textContent = "Sign Up";
        authSubmit.textContent = "Sign Up";
        authToggleLink.textContent = "Already have an account? Login";
        authName.style.display = "block";
      }
      authEmail.value = "";
      authPassword.value = "";
      authName.value = "";
    }

    authToggleLink.addEventListener('click', () => {
      toggleAuthMode();
    });
    authToggleLink.addEventListener('keypress', e => {
      if(e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        toggleAuthMode();
      }
    });

    // Email regex simple validation
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    // Enable/disable inputs & button & show spinner
    function setLoading(loading) {
      if(loading) {
        authSpinner.classList.add("active");
        authSubmit.disabled = true;
        authEmail.disabled = true;
        authPassword.disabled = true;
        authName.disabled = true;
        authToggleLink.style.pointerEvents = "none";
      } else {
        authSpinner.classList.remove("active");
        authSubmit.disabled = false;
        authEmail.disabled = false;
        authPassword.disabled = false;
        authName.disabled = false;
        authToggleLink.style.pointerEvents = "auto";
      }
    }

    authSubmit.addEventListener("click", async () => {
      authError.textContent = "";
      const email = authEmail.value.trim().toLowerCase();
      const password = authPassword.value;
      const name = authName.value.trim();

      if(!validateEmail(email)) {
        authError.textContent = "Invalid email address.";
        return;
      }
      if(password.length < 6) {
        authError.textContent = "Password must be at least 6 characters.";
        return;
      }
      if(!isLoginMode && name.length < 2) {
        authError.textContent = "Please enter your full name.";
        return;
      }

      setLoading(true);

      try {
        if(isLoginMode) {
          await loginUser(email, password);
        } else {
          await signupUser(email, password, name);
        }
        // Successful login/signup: redirect to dashboard URL
        window.location.href = "/dashboard/index.html";
      } catch(error) {
        let msg = "Authentication failed.";
        if(error.code === "auth/user-not-found") msg = "User not found.";
        else if(error.code === "auth/wrong-password") msg = "Incorrect password.";
        else if(error.code === "auth/email-already-in-use") msg = "Email already in use.";
        else if(error.code === "auth/weak-password") msg = "Weak password.";
        authError.textContent = msg;
        setLoading(false);
      }
    });

    async function loginUser(email, password) {
      const userCredential = await auth.signInWithEmailAndPassword(email, password);
      const user = userCredential.user;
      await ensureUserDoc(user);
      await creditLoginBonus(user);
      return user;
    }

    async function signupUser(email, password, name) {
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      const user = userCredential.user;
      await user.updateProfile({ displayName: name });
      await ensureUserDoc(user);
      return user;
    }

    async function ensureUserDoc(user) {
      const userDocRef = db.collection('users').doc(user.uid);
      const doc = await userDocRef.get();
      if (!doc.exists) {
        await userDocRef.set({
          email: user.email,
          name: user.displayName || "",
          logcash: 10,
          ownedStyles: [],
          ownedTitles: [],
          currentStyle: null,
          currentTitle: null,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });
      } else {
        const updates = {};
        if (!doc.data().name && user.displayName) updates.name = user.displayName;
        updates.lastLogin = firebase.firestore.FieldValue.serverTimestamp();
        if (Object.keys(updates).length) await userDocRef.update(updates);
      }
    }

    async function creditLoginBonus(user) {
      if (!user) return;
      const userDocRef = db.collection('users').doc(user.uid);
      await userDocRef.update({
        logcash: firebase.firestore.FieldValue.increment(10),
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
  </script>
</body>
</html>
