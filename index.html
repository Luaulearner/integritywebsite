<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SuperCool Login UI</title>
<style>
  body {
    background: linear-gradient(135deg, #120f2b, #4e2370);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    height: 100vh;
  }
  .cube-ui {
    background: #1e1540;
    border-radius: 16px;
    box-shadow:
      0 0 8px #7b45d1,
      inset 0 0 10px #9c64ff;
    width: 320px;
    padding: 24px;
    box-sizing: border-box;
  }
  .cube-ui h2 {
    margin: 0 0 16px 0;
    font-weight: 700;
    text-align: center;
    letter-spacing: 1.2px;
  }
  .cube-ui input {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 14px;
    border-radius: 12px;
    border: 2px solid #7b45d1;
    background: #2a1e5d;
    color: white;
    font-size: 16px;
    outline: none;
    transition: border-color 0.3s;
  }
  .cube-ui input:focus {
    border-color: #a67fff;
  }
  .cube-ui button {
    width: 100%;
    background: #7b45d1;
    border: none;
    border-radius: 12px;
    color: white;
    font-weight: 700;
    font-size: 16px;
    padding: 12px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .cube-ui button:hover {
    background: #a67fff;
  }
  .notification {
    margin-bottom: 16px;
    padding: 12px;
    border-radius: 12px;
    text-align: center;
    font-weight: 600;
  }
  .success {
    background: #3a7d44;
  }
  .error {
    background: #7d3a3a;
  }
  .main-ui {
    text-align: center;
  }
  .logcash {
    font-size: 18px;
    margin: 20px 0 0 0;
    font-weight: 700;
  }
</style>
</head>
<body>

<div id="app" class="cube-ui">
  <h2>SuperCool Login</h2>
  <div id="notification"></div>
  <input type="text" id="username" placeholder="Username (unique)" />
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Password" />
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn" style="margin-top: 8px; background:#4a357a;">Log In</button>
</div>

<script type="module">
// Import Firebase SDK functions
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

// Your Firebase config â€” replace with your own!
const firebaseConfig = {
  apiKey: "AIzaSyBjA2O3QDuKsAGLzq008VEDug69WDroulI",
  authDomain: "supercoollogin999.firebaseapp.com",
  databaseURL: "https://supercoollogin999-default-rtdb.firebaseio.com",
  projectId: "supercoollogin999",
  storageBucket: "supercoollogin999.appspot.com",
  messagingSenderId: "472488806884",
  appId: "1:472488806884:web:a2ef5e6a2660a36ac51ff1"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const appDiv = document.getElementById('app');
const notificationDiv = document.getElementById('notification');

function showNotification(message, type='success') {
  notificationDiv.textContent = message;
  notificationDiv.className = `notification ${type}`;
  setTimeout(() => {
    notificationDiv.textContent = '';
    notificationDiv.className = '';
  }, 3500);
}

async function usernameExists(username) {
  const dbRef = ref(db, 'usernames/' + username);
  const snapshot = await get(dbRef);
  return snapshot.exists();
}

async function createUserData(uid, username) {
  // Save username mapping (to prevent duplicates)
  await set(ref(db, 'usernames/' + username), uid);
  // Save user profile with LogCash = 2 + count of accounts created
  const usersSnapshot = await get(ref(db, 'users'));
  const accountsCount = usersSnapshot.exists() ? Object.keys(usersSnapshot.val()).length : 0;
  const logCash = 2 + accountsCount;
  await set(ref(db, 'users/' + uid), { username, logCash });
}

document.getElementById('signupBtn').addEventListener('click', async () => {
  const username = document.getElementById('username').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  if (!username || !email || !password) {
    showNotification("Please fill in all fields", 'error');
    return;
  }

  if (await usernameExists(username)) {
    showNotification("Username already taken", 'error');
    return;
  }

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    await createUserData(user.uid, username);
    showNotification("Signed up successfully!");
    loadMainUI(user.uid);
  } catch (error) {
    showNotification(error.message, 'error');
  }
});

document.getElementById('loginBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  if (!email || !password) {
    showNotification("Fill email and password", 'error');
    return;
  }

  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    showNotification("Logged in successfully!");
    loadMainUI(user.uid);
  } catch (error) {
    showNotification(error.message, 'error');
  }
});

async function loadMainUI(uid) {
  const userRef = ref(db, 'users/' + uid);
  const snapshot = await get(userRef);
  if (!snapshot.exists()) {
    showNotification("User data not found!", 'error');
    return;
  }
  const userData = snapshot.val();

  appDiv.innerHTML = `
    <h2>Welcome, ${userData.username}</h2>
    <div class="logcash">LogCash: ${userData.logCash}</div>
    <button id="logoutBtn" style="margin-top:20px; background:#7b45d1;">Log Out</button>
  `;

  document.getElementById('logoutBtn').addEventListener('click', () => {
    auth.signOut();
    location.reload();
  });
}

// Auto-load main UI if user already logged in
onAuthStateChanged(auth, user => {
  if (user) loadMainUI(user.uid);
});
</script>

</body>
</html>