<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: auto; }
  input, button { width: 100%; margin: 8px 0; padding: 10px; font-size: 16px; }
  .message { margin-top: 15px; color: green; }
  .error { color: red; }
</style>
</head>
<body>

<h2>Sign Up</h2>
<input type="text" id="signup-username" placeholder="Username" />
<input type="email" id="signup-email" placeholder="Email" />
<input type="password" id="signup-password" placeholder="Password" />
<button id="signup-btn">Sign Up</button>
<div id="signup-msg"></div>

<hr />

<h2>Log In</h2>
<input type="text" id="login-username" placeholder="Username" />
<input type="password" id="login-password" placeholder="Password" />
<button id="login-btn">Log In</button>
<div id="login-msg"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // Your Firebase config here â€” replace with your actual config
  const firebaseConfig = {
    apiKey: "AIzaSyBjA2O3QDuKsAGLzq008VEDug69WDroulI",
    authDomain: "supercoollogin999.firebaseapp.com",
    projectId: "supercoollogin999",
    storageBucket: "supercoollogin999.firebasestorage.app",
    messagingSenderId: "472488806884",
    appId: "1:472488806884:web:a2ef5e6a2660a36ac51ff1"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Sign Up handler
  document.getElementById("signup-btn").onclick = async () => {
    const username = document.getElementById("signup-username").value.trim();
    const email = document.getElementById("signup-email").value.trim();
    const password = document.getElementById("signup-password").value;

    const msgEl = document.getElementById("signup-msg");
    msgEl.textContent = "";

    if (!username || !email || !password) {
      msgEl.textContent = "Please fill in all fields.";
      msgEl.className = "error";
      return;
    }

    try {
      // Check if username is taken
      const usernameQuery = await db.collection("usernames").where("username", "==", username).get();
      if (!usernameQuery.empty) {
        msgEl.textContent = "Username is already taken.";
        msgEl.className = "error";
        return;
      }

      // Create user with email & password
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      const uid = userCredential.user.uid;

      // Save username linked to uid
      await db.collection("usernames").doc(uid).set({
        username: username,
        email: email,
      });

      msgEl.textContent = "Sign up successful! You can now log in.";
      msgEl.className = "message";

      // Clear inputs
      document.getElementById("signup-username").value = "";
      document.getElementById("signup-email").value = "";
      document.getElementById("signup-password").value = "";

    } catch (error) {
      msgEl.textContent = error.message;
      msgEl.className = "error";
    }
  };

  // Log In handler
  document.getElementById("login-btn").onclick = async () => {
    const username = document.getElementById("login-username").value.trim();
    const password = document.getElementById("login-password").value;

    const msgEl = document.getElementById("login-msg");
    msgEl.textContent = "";

    if (!username || !password) {
      msgEl.textContent = "Please fill in all fields.";
      msgEl.className = "error";
      return;
    }

    try {
      // Look up email by username
      const usernameQuery = await db.collection("usernames").where("username", "==", username).get();
      if (usernameQuery.empty) {
        msgEl.textContent = "Username not found.";
        msgEl.className = "error";
        return;
      }

      const userData = usernameQuery.docs[0].data();
      const email = userData.email;

      // Sign in with email + password
      await auth.signInWithEmailAndPassword(email, password);

      msgEl.textContent = "Logged in successfully!";
      msgEl.className = "message";

      // Clear inputs
      document.getElementById("login-username").value = "";
      document.getElementById("login-password").value = "";

    } catch (error) {
      msgEl.textContent = error.message;
      msgEl.className = "error";
    }
  };
</script>

</body>
</html>