<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Global Messaging Website with Firebase</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    body {
      margin: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Poppins', sans-serif;
      color: #fafafa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    .container {
      background: rgba(0, 0, 0, 0.6);
      width: 400px;
      max-width: 95vw;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      height: 600px;
    }
    header {
      padding: 20px;
      text-align: center;
      background: rgba(255,255,255,0.1);
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    header h1 {
      margin: 0;
      font-weight: 600;
      font-size: 1.8rem;
      letter-spacing: 1px;
      user-select: none;
    }
    #messages {
      flex-grow: 1;
      padding: 15px;
      overflow-y: auto;
      user-select: text;
      scrollbar-width: thin;
      scrollbar-color: #764ba2 transparent;
      background: rgba(255,255,255,0.05);
      border-radius: 0 0 0 0;
    }
    #messages::-webkit-scrollbar {
      width: 8px;
    }
    #messages::-webkit-scrollbar-track {
      background: transparent;
    }
    #messages::-webkit-scrollbar-thumb {
      background-color: #764ba2;
      border-radius: 4px;
    }
    .message {
      margin-bottom: 12px;
      padding: 10px 14px;
      background: rgba(118, 75, 162, 0.3);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(118, 75, 162, 0.4);
      word-wrap: break-word;
      font-size: 0.9rem;
      border-left: 4px solid #ffcc00;
      position: relative;
      line-height: 1.3;
    }
    .message .meta {
      font-weight: 600;
      font-size: 0.75rem;
      opacity: 0.8;
      margin-bottom: 4px;
      color: #ffcc00;
      user-select: text;
    }
    .message .timestamp {
      position: absolute;
      bottom: 6px;
      right: 10px;
      font-size: 0.7rem;
      opacity: 0.6;
      color: #ffd966;
      user-select: text;
    }
    form {
      display: flex;
      flex-direction: column;
      padding: 20px;
      background: rgba(0,0,0,0.3);
      border-bottom-left-radius: 12px;
      border-bottom-right-radius: 12px;
      gap: 8px;
    }
    input[type="text"], textarea {
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 1rem;
      font-family: 'Poppins', sans-serif;
      resize: none;
    }
    input[type="text"] {
      background: #eee;
      color: #333;
      height: 40px;
    }
    textarea {
      background: #ddd;
      color: #111;
      min-height: 70px;
      max-height: 140px;
      overflow-y: auto;
    }
    input[type="text"]:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 8px #ffcc00;
    }
    button {
      background: #ffcc00;
      border: none;
      border-radius: 8px;
      padding: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      color: #4F3A00;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background: #e6b800;
    }
    button:disabled {
      background: #8d7b00;
      cursor: not-allowed;
    }
    .footer {
      text-align: center;
      margin-top: 8px;
      font-size: 0.75rem;
      color: #ccc;
      user-select: none;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container" role="main" aria-label="Global Messaging Website with Firebase">
    <header>
      <h1>üåê Global Messenger</h1>
    </header>
    <div id="messages" aria-live="polite" aria-relevant="additions"></div>
    <form id="messageForm" aria-label="Send a message form">
      <input type="text" id="username" name="username" placeholder="Your name" autocomplete="off" aria-label="Your name" required minlength="1" maxlength="32" />
      <textarea id="message" name="message" placeholder="Your message" rows="3" aria-label="Your message" required maxlength="280"></textarea>
      <button type="submit" id="sendBtn" disabled>Send</button>
    </form>
    <div class="footer">Messages are synced globally via Firebase Realtime Database</div>
  </div>
  <script>
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBjA2O3QDuKsAGLzq008VEDug69WDroulI",
      authDomain: "supercoollogin999.firebaseapp.com",
      databaseURL: "https://supercoollogin999-default-rtdb.firebaseio.com",
      projectId: "supercoollogin999",
      storageBucket: "supercoollogin999.firebasestorage.app",
      messagingSenderId: "472488806884",
      appId: "1:472488806884:web:d904be3b09548dbbc51ff1",
      measurementId: "G-03NQP912BX"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const messagesRef = db.ref('messages');

    const messagesEl = document.getElementById('messages');
    const form = document.getElementById('messageForm');
    const usernameInput = document.getElementById('username');
    const messageInput = document.getElementById('message');
    const sendBtn = document.getElementById('sendBtn');

    // Enable send button only if both inputs have content
    function validateForm() {
      const valid = usernameInput.value.trim().length > 0 && messageInput.value.trim().length > 0;
      sendBtn.disabled = !valid;
    }

    usernameInput.addEventListener('input', validateForm);
    messageInput.addEventListener('input', validateForm);

    function createMessageElement(msg) {
      const div = document.createElement('div');
      div.className = 'message';

      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = msg.username || "Anonymous";

      const text = document.createElement('div');
      text.textContent = msg.text;

      const ts = document.createElement('div');
      ts.className = 'timestamp';
      let d = new Date(msg.timestamp);
      if (isNaN(d.getTime())) {
        d = new Date(); // fallback to current date
      }
      ts.textContent = d.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});

      div.appendChild(meta);
      div.appendChild(text);
      div.appendChild(ts);

      return div;
    }

    // Render all messages, clearing existing
    function renderMessages(messages) {
      messagesEl.innerHTML = "";
      messages.forEach(msg => {
        messagesEl.appendChild(createMessageElement(msg));
      });
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // Listen for messages added in realtime
    let messages = [];
    messagesRef.limitToLast(100).on('value', snapshot => {
      const data = snapshot.val();
      messages = [];
      for (const key in data) {
        if (data.hasOwnProperty(key)) {
          messages.push(data[key]);
        }
      }
      // Sort messages by timestamp ascending
      messages.sort((a,b) => new Date(a.timestamp) - new Date(b.timestamp));
      renderMessages(messages);
    });

    // On form submit, push message to database
    form.addEventListener('submit', e => {
      e.preventDefault();
      if(sendBtn.disabled) return;

      const newMsg = {
        username: usernameInput.value.trim().substring(0,32),
        text: messageInput.value.trim().substring(0,280),
        timestamp: new Date().toISOString()
      };

      messagesRef.push(newMsg).then(() => {
        messageInput.value = "";
        validateForm();
      }).catch((error) => {
        alert("Error sending message: " + error.message);
      });
    });

    validateForm();
  </script>
</body>
</html>

